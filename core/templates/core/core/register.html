<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Registrar - SGEA</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body.register-page{display:flex;align-items:center;justify-content:center;min-height:80vh;background:#f4f7f6}
  </style>
  <style>
    /* make interactive icons show pointer cursor */
    .toggle-password{cursor:pointer}
    /* date input calendar indicator (WebKit) */
    input[type="date"]::-webkit-calendar-picker-indicator{cursor:pointer}
    /* fallback: make whole date input show pointer */
    input[type="date"]{cursor:pointer}
  </style>
</head>
<body class="register-page">
  <div class="container">
    {% if success %}
      <div class="alert alert-success">Conta criada. Enviamos um e-mail com o c√≥digo de verifica√ß√£o.</div>
      <p>Verifique sua caixa de entrada. Ao receber o c√≥digo, voc√™ ser√° direcionado para verificar.</p>
      <a href="/" class="btn">Ir para login</a>
    {% else %}
      <style>
        .card{max-width:520px;margin:20px auto;padding:18px;border-radius:8px;background:#fff;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
        .card input{width:100%;padding:10px 12px;margin:8px 0;border:1px solid #ddd;border-radius:6px}
        .row{display:flex;gap:8px}
        .row .col{flex:1}
      </style>
      {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
      <div class="card" style="display:flex;flex-direction:column;align-items:center;">
      <h2 style="text-align:center;margin-top:0;margin-bottom:10px;">Registro</h2>
      <form method="post" enctype="multipart/form-data" id="register-form" style="width:360px;">
        {% csrf_token %}
        <div class="row"><div class="col"><input name="first_name" placeholder="Nome" required></div><div class="col"><input name="last_name" placeholder="Sobrenome" required></div></div>
        <div><input name="email" placeholder="E-mail" type="email" required></div>
        <div><input name="telefone" placeholder="Telefone" id="telefone" autocomplete="tel" required></div>
        <div><label>Data de Nascimento</label><input name="data_nascimento" id="data_nascimento" type="date" required></div>
        <div style="display:flex;gap:8px;"><div style="flex:1;"><label>Senha</label><div style="position:relative;"><input name="password" id="password" placeholder="Senha" type="password" required style="width:100%;padding-right:44px;"><button type="button" class="toggle-password" data-target="password" style="position:absolute;right:6px;top:50%;transform:translateY(-50%);background:transparent;border:none;">üëÅÔ∏è</button></div></div>
        <div style="flex:1;"><label>Confirmar senha</label><div style="position:relative;"><input name="password_confirm" id="password_confirm" placeholder="Confirmar senha" type="password" required style="width:100%;padding-right:44px;"><button type="button" class="toggle-password" data-target="password_confirm" style="position:absolute;right:6px;top:50%;transform:translateY(-50%);background:transparent;border:none;">üëÅÔ∏è</button></div></div></div>
        <div id="pw-hint" style="font-size:0.9rem;color:#666;margin-top:6px;">Senha: m√≠nimo 8 caracteres, letras, n√∫meros e caracteres especiais.</div>
        <div style="margin-top:12px;display:flex;gap:12px;">
          <button class="btn primary" type="submit" style="flex:1;">Registrar</button>
          <a href="/" class="btn secondary" style="flex:1;display:inline-flex;align-items:center;justify-content:center;">Voltar</a>
        </div>
      </form>
      </div>
      <script>
      // phone mask while keeping placeholder 'Telefone'
      function phoneMask(v){ v = v.replace(/\D/g,'').slice(0,11); if(v.length<=2) return '('+v; if(v.length<=6) return '('+v.slice(0,2)+') '+v.slice(2); return '('+v.slice(0,2)+') '+v.slice(2,7)+'-'+v.slice(7); }
      const tel = document.getElementById('telefone');
      if(tel){ tel.addEventListener('input', function(){ this.value = phoneMask(this.value); }); tel.placeholder = 'Telefone'; }

      // password visibility toggles
      document.querySelectorAll('.toggle-password').forEach(function(b){ b.addEventListener('click', function(){ const t = b.getAttribute('data-target'); const inp = document.getElementById(t); if(!inp) return; inp.type = inp.type === 'password' ? 'text' : 'password'; }); });

      // client-side validation for password match and strength
      document.getElementById('register-form').addEventListener('submit', function(e){
        const p = document.getElementById('password').value || '';
        const pc = document.getElementById('password_confirm').value || '';
        const strength = /(?=.*[A-Za-z])(?=.*\d)(?=.*[^A-Za-z0-9])/;
        if(p.length < 8 || !strength.test(p)){
          e.preventDefault(); alert('Senha deve ter m√≠nimo 8 caracteres e conter letras, n√∫meros e caracteres especiais.'); return false;
        }
        if(p !== pc){ e.preventDefault(); alert('As senhas n√£o coincidem.'); return false; }
      });
      </script>
    {% endif %}
  </div>
</body>
</html>
